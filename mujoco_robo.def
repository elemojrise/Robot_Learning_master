Bootstrap: docker
From: nvidia/cuda:11.1.1-cudnn8-devel-ubuntu20.04.1    

%environment
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/sagar/.mujoco/mujoco210/bin
    export MUJOCO_PY_MUJOCO_PATH=/root/.mujoco/mujoco210/
    export MUJOCO_PY_MJKEY_PATH=/root/.mujoco/mjkey.txt

%files
    /cluster/home/ojrise/.mujoco/mjkey.txt /opt/mjkey.txt

%post
    export DEBIAN_FRONTEND=noninteractive
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/sagar/.mujoco/mujoco210/bin
    export MUJOCO_PY_MUJOCO_PATH=/root/.mujoco/mujoco210/
    export MUJOCO_PY_MJKEY_PATH=/root/.mujoco/mjkey.txt
    
    apt-get -y update -q
    apt-get -y install curl git libgl1-mesa-dev libgl1-mesa-glx libglew-dev \
         libosmesa6-dev software-properties-common net-tools unzip vim \
         virtualenv wget xpra xserver-xorg-dev libglfw3-dev patchelf

    python3 -m pip install -U pip

    mkdir -p /root/.mujoco \
        && wget https://mujoco.org/download/mujoco210-linux-x86_64.tar.gz -O mujoco.tar.gz \
        && tar -xf mujoco.tar.gz -C /root/.mujoco \
        && rm mujoco.tar.gz     

    mv /opt/mjkey.txt /root/.mujoco/mjkey.txt
